import Link from 'next/link'

## Virtual Machine

Our stack based virtual machine is designed for the purpose of reading data from EVM compatabile blockchains and generating proofs to verify the integrity of that data.

### Commands

Internally a virtual machine program maintains two registers:

- An operations register (`ops`)
- An inputs register (`inputs`)

The [OP codes](/op-code-reference) exposed by the public API define operations that the virtual machine interprets.

Operations can operate on/using inputs in the inputs register as well as manipulating items on the stack and previously fetched outputs. The majority of the OP codes are responsible for the generation (and manipulation) of storage slot IDs and the extraction/post processing of the data contained within.

### Requests

A virtual machine request (`EVMRequest`) is a program with the explicit specification of the number of expected outputs.

Requests can nest additional programs for more complicated use cases.

### Internal state

The virtual machine maintains an internal state that constitutes:

- `target` - the current target contract for which we are fetching data.
- `slot` - the storage slot ID for which we are fetching data.
- `stack` - The virtual machine stack.  It provides a structured way to handle execution states and data, facilitating efficient and organized program execution within the VM.
- `exitCode` - an exit code that is handled dependant on user specified flags.

- `needs` - an array keeps track of required storage/account proofs.
- `outputs` - an array holds lazily resolved outputs.

In the Typescript implementation this state is represented by the `MachineState` class of `vm.ts`, whilst the Solidity implementation defines the `Machine` struct contained within `EVMProver.sol`